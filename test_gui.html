<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E2E Testing Agent</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }
        .header h1 { color: #667eea; font-size: 2.5em; margin-bottom: 10px; }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        .status-indicator.online { background: #10b981; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .test-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .test-section h2 { color: #333; margin-bottom: 20px; font-size: 1.5em; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: 600; }
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        textarea { resize: vertical; min-height: 100px; font-family: inherit; }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .loading { display: none; text-align: center; padding: 20px; }
        .loading.active { display: block; }
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .result { margin-top: 20px; padding: 20px; border-radius: 8px; display: none; }
        .result.active { display: block; }
        .result.success { background: #d1fae5; border: 2px solid #10b981; }
        .result.error { background: #fee2e2; border: 2px solid #ef4444; }
        .result h3 { margin-bottom: 15px; color: #333; font-size: 1.3em; }
        .step-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            margin-right: 10px;
        }
        .step-description { font-size: 16px; color: #333; margin-top: 8px; font-weight: 500; }
        .step-details { font-size: 13px; color: #666; margin-top: 5px; }
        .summary-box {
            background: #f0f9ff;
            border: 2px solid #3b82f6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .summary-box strong { color: #1e40af; }
        .error-box {
            background: #fef2f2;
            border: 2px solid #ef4444;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            color: #991b1b;
        }
        .error-box strong { color: #7f1d1d; }
        .status-passed {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
        }
        .status-failed {
            display: inline-block;
            background: #ef4444;
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
        }
        .example-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .example-btn {
            background: #f3f4f6;
            color: #333;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .example-btn:hover {
            background: #e5e7eb;
            border-color: #667eea;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ E2E Testing Agent</h1>
            <p><span class="status-indicator" id="statusIndicator"></span><span id="statusText">Checking server...</span></p>
        </div>

        <div class="test-section">
            <h2>üíö Health Check</h2>
            <button onclick="checkHealth()">Test Server</button>
            <div class="loading" id="healthLoading"><div class="spinner"></div><p>Checking...</p></div>
            <div class="result" id="healthResult"></div>
        </div>

        <div class="test-section">
            <h2>üîç Parse Instructions</h2>
            <div class="form-group">
                <label>What do you want to test? (in plain English):</label>
                <textarea id="parseInstruction" placeholder="e.g., Click the login button and verify the page redirects">Click the login button</textarea>
            </div>
            <div class="form-group">
                <label>Website URL:</label>
                <input type="text" id="parseUrl" value="https://example.com" placeholder="https://example.com">
            </div>
            <button onclick="testParse()">Analyze Test Steps</button>

            <div class="example-buttons">
                <button class="example-btn" onclick="fillParseExample1()">Login Test</button>
                <button class="example-btn" onclick="fillParseExample2()">Search Test</button>
                <button class="example-btn" onclick="fillParseExample3()">Form Test</button>
            </div>

            <div class="loading" id="parseLoading"><div class="spinner"></div><p>Analyzing...</p></div>
            <div class="result" id="parseResult"></div>
        </div>

        <div class="test-section">
            <h2>üöÄ Full E2E Test</h2>
            <div class="form-group">
                <label>Test scenario:</label>
                <textarea id="testInstruction" placeholder="e.g., Navigate to homepage and verify the main heading is visible">Go to website and verify homepage loads</textarea>
            </div>
            <div class="form-group">
                <label>Target Website:</label>
                <input type="text" id="testUrl" value="https://example.com" placeholder="https://example.com">
            </div>
            <button onclick="runFullTest()" id="testButton">Run Test</button>

            <div class="example-buttons">
                <button class="example-btn" onclick="fillTestExample1()">Example.com Test</button>
                <button class="example-btn" onclick="fillTestExample2()">Google Search</button>
                <button class="example-btn" onclick="fillTestExample3()">Wikipedia Test</button>
            </div>

            <div class="loading" id="testLoading"><div class="spinner"></div><p>Running test... This may take 10-30 seconds</p></div>
            <div class="result" id="testResult"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';

        window.onload = () => checkServerStatus();

        async function checkServerStatus() {
            try {
                const r = await fetch(API_BASE + '/health');
                const data = await r.json();
                if (r.ok && data.agent_ready) {
                    document.getElementById('statusIndicator').className = 'status-indicator online';
                    document.getElementById('statusText').textContent = 'Server Online & Agent Ready ‚úì';
                } else if (r.ok) {
                    document.getElementById('statusIndicator').className = 'status-indicator';
                    document.getElementById('statusText').textContent = 'Server Online but Agent Not Ready ‚ö†Ô∏è';
                }
            } catch (e) {
                document.getElementById('statusIndicator').className = 'status-indicator';
                document.getElementById('statusText').textContent = 'Server Offline ‚úó';
            }
        }

        async function checkHealth() {
            const loading = document.getElementById('healthLoading');
            const result = document.getElementById('healthResult');
            loading.classList.add('active');
            result.classList.remove('active');
            try {
                const r = await fetch(API_BASE + '/health');
                const data = await r.json();
                loading.classList.remove('active');
                result.classList.add('active', 'success');
                result.innerHTML = `
                    <h3>‚úÖ Server is Healthy!</h3>
                    <div class="summary-box">
                        <p><strong>Service:</strong> ${data.service}</p>
                        <p><strong>Status:</strong> ${data.status}</p>
                        <p><strong>Version:</strong> ${data.version}</p>
                        <p><strong>Agent Ready:</strong> ${data.agent_ready ? '‚úÖ Yes' : '‚ùå No'}</p>
                    </div>
                `;
            } catch (e) {
                loading.classList.remove('active');
                result.classList.add('active', 'error');
                result.innerHTML = `<h3>‚ùå Connection Failed</h3><p>${e.message}</p><p style="margin-top:10px;color:#666;">Make sure Flask server is running on http://localhost:5000</p>`;
            }
        }

        async function testParse() {
            const instruction = document.getElementById('parseInstruction').value;
            const targetUrl = document.getElementById('parseUrl').value;
            const loading = document.getElementById('parseLoading');
            const result = document.getElementById('parseResult');

            if (!instruction.trim()) {
                alert('Please enter test instructions');
                return;
            }

            loading.classList.add('active');
            result.classList.remove('active');

            try {
                const r = await fetch(API_BASE + '/api/parse', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ instruction, target_url: targetUrl })
                });
                const data = await r.json();
                loading.classList.remove('active');
                result.classList.add('active', data.success ? 'success' : 'error');

                if (data.success && data.steps && data.steps.length > 0) {
                    let html = '';
                    data.steps.forEach((s, i) => {
                        html += `
                            <div class="step-item">
                                <span class="step-number">Step ${i + 1}</span>
                                <div class="step-description">${s.description}</div>
                                <div class="step-details">Action: <strong>${s.action}</strong>${s.target ? ` | Target: <strong>${s.target}</strong>` : ''}${s.value ? ` | Value: <strong>${s.value}</strong>` : ''}</div>
                            </div>
                        `;
                    });
                    result.innerHTML = `
                        <h3>‚úÖ Analysis Complete!</h3>
                        <div class="summary-box">
                            <p><strong>Website:</strong> ${targetUrl}</p>
                            <p><strong>Total Steps:</strong> ${data.steps.length}</p>
                        </div>
                        <p style="margin:15px 0;font-weight:600">Your test will perform:</p>
                        ${html}
                    `;
                } else {
                    result.innerHTML = `<h3>‚ö†Ô∏è Parse Result</h3><p>${data.message || 'No steps were generated. The agent will parse instructions during execution.'}</p>`;
                }
            } catch (e) {
                loading.classList.remove('active');
                result.classList.add('active', 'error');
                result.innerHTML = `<h3>‚ùå Error</h3><p>Failed to connect to server: ${e.message}</p>`;
            }
        }

        async function runFullTest() {
            const instruction = document.getElementById('testInstruction').value;
            const targetUrl = document.getElementById('testUrl').value;
            const loading = document.getElementById('testLoading');
            const result = document.getElementById('testResult');
            const button = document.getElementById('testButton');

            if (!instruction.trim() || !targetUrl.trim()) {
                alert('Please fill in both test scenario and target URL');
                return;
            }

            button.disabled = true;
            loading.classList.add('active');
            result.classList.remove('active', 'success', 'error');

            try {
                const r = await fetch(API_BASE + '/api/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        instruction,
                        target_url: targetUrl,
                        browser: 'chromium',
                        headless: true
                    })
                });

                const data = await r.json();
                loading.classList.remove('active');
                button.disabled = false;

                const report = data.report || {};
                const testPassed = data.success === true && (data.status === 'passed' || report.status === 'passed');
                const testFailed = data.success === false || data.status === 'failed' || report.status === 'failed';

                result.classList.add('active');

                if (testPassed) {
                    result.classList.add('success');
                    let stepsHtml = '';
                    if (report.steps && report.steps.length > 0) {
                        stepsHtml = '<div style="margin-top:15px;">';
                        report.steps.forEach((step, i) => {
                            const statusIcon = step.status === 'passed' ? '‚úÖ' : step.status === 'failed' ? '‚ùå' : '‚è≠Ô∏è';
                            stepsHtml += `
                                <div class="step-item">
                                    ${statusIcon} <strong>Step ${step.step_number || i+1}:</strong> ${step.description}
                                    ${step.error ? `<div style="color:#dc2626;margin-top:5px;">Error: ${step.error}</div>` : ''}
                                </div>
                            `;
                        });
                        stepsHtml += '</div>';
                    }
                    result.innerHTML = `
                        <h3>‚úÖ Test Passed!</h3>
                        <div class="summary-box">
                            <p><strong>Website:</strong> ${targetUrl}</p>
                            <p><strong>Status:</strong> <span class="status-passed">PASSED ‚úì</span></p>
                            ${report.total_steps ? `<p><strong>Total Steps:</strong> ${report.total_steps}</p>` : ''}
                            ${report.passed_steps !== undefined ? `<p><strong>Passed:</strong> ${report.passed_steps} / ${report.total_steps}</p>` : ''}
                            ${report.execution_time ? `<p><strong>Duration:</strong> ${report.execution_time}s</p>` : ''}
                        </div>
                        ${report.summary ? `<p style="margin-top:10px;padding:10px;background:#f0f9ff;border-radius:6px;font-weight:600;">${report.summary}</p>` : ''}
                        ${stepsHtml}
                    `;
                } else if (testFailed) {
                    result.classList.add('error');
                    let stepsHtml = '';
                    if (report.steps && report.steps.length > 0) {
                        stepsHtml = '<div style="margin-top:15px;">';
                        report.steps.forEach((step, i) => {
                            const statusIcon = step.status === 'passed' ? '‚úÖ' : step.status === 'failed' ? '‚ùå' : '‚è≠Ô∏è';
                            stepsHtml += `
                                <div class="step-item" style="border-left-color:${step.status === 'failed' ? '#ef4444' : '#667eea'};">
                                    ${statusIcon} <strong>Step ${step.step_number || i+1}:</strong> ${step.description}
                                    ${step.error ? `<div style="color:#dc2626;margin-top:5px;font-weight:600;">‚ùå ${step.error}</div>` : ''}
                                </div>
                            `;
                        });
                        stepsHtml += '</div>';
                    }
                    result.innerHTML = `
                        <h3>‚ùå Test Failed!</h3>
                        <div class="summary-box" style="background:#fef2f2;border-color:#ef4444;">
                            <p><strong>Website:</strong> ${targetUrl}</p>
                            <p><strong>Status:</strong> <span class="status-failed">FAILED ‚úó</span></p>
                            ${report.total_steps ? `<p><strong>Total Steps:</strong> ${report.total_steps}</p>` : ''}
                            ${report.passed_steps !== undefined ? `<p><strong>Passed:</strong> ${report.passed_steps} / ${report.total_steps}</p>` : ''}
                            ${report.failed_steps !== undefined ? `<p><strong>Failed:</strong> ${report.failed_steps}</p>` : ''}
                            ${report.execution_time ? `<p><strong>Duration:</strong> ${report.execution_time}s</p>` : ''}
                        </div>
                        ${(data.error || report.error) ? `
                            <div class="error-box">
                                <strong>‚ùå Error:</strong><br>
                                ${data.error || report.error}
                            </div>
                        ` : ''}
                        ${report.summary ? `<p style="margin-top:10px;padding:10px;background:#fef2f2;border-radius:6px;font-weight:600;">${report.summary}</p>` : ''}
                        ${stepsHtml}
                    `;
                } else {
                    result.classList.add('error');
                    result.innerHTML = `
                        <h3>‚ö†Ô∏è Test Status Unknown</h3>
                        <div class="summary-box">
                            <p><strong>Website:</strong> ${targetUrl}</p>
                            <p><strong>Status:</strong> ${data.status || report.status || 'unknown'}</p>
                        </div>
                        <p>Raw response:</p>
                        <pre style="background:#f3f4f6;padding:10px;border-radius:6px;overflow-x:auto;font-size:12px;">${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (e) {
                loading.classList.remove('active');
                button.disabled = false;
                result.classList.add('active', 'error');
                result.innerHTML = `
                    <h3>‚ùå Connection Error</h3>
                    <p>Failed to connect to server: ${e.message}</p>
                    <p style="margin-top:10px;color:#666;font-size:14px;">Make sure Flask server is running on http://localhost:5000</p>
                `;
            }
        }

        // Example fillers for Parse section
        function fillParseExample1() {
            document.getElementById('parseInstruction').value = 'Click the login button and verify the page redirects to dashboard';
            document.getElementById('parseUrl').value = 'https://example.com';
        }

        function fillParseExample2() {
            document.getElementById('parseInstruction').value = 'Search for "playwright testing" in the search box and verify results appear';
            document.getElementById('parseUrl').value = 'https://duckduckgo.com';
        }

        function fillParseExample3() {
            document.getElementById('parseInstruction').value = 'Fill out the contact form with name "Test User" and email "test@example.com" then submit';
            document.getElementById('parseUrl').value = 'https://example.com/contact';
        }

        // Example fillers for Full Test section
        function fillTestExample1() {
            document.getElementById('testInstruction').value = 'Navigate to the website and verify the More information link is visible';
            document.getElementById('testUrl').value = 'https://example.com';
        }

        function fillTestExample2() {
            document.getElementById('testInstruction').value = 'Search for "web automation" and verify search results appear';
            document.getElementById('testUrl').value = 'https://www.google.com';
        }

        function fillTestExample3() {
            document.getElementById('testInstruction').value = 'Navigate to Wikipedia homepage and verify the search box is visible';
            document.getElementById('testUrl').value = 'https://www.wikipedia.org';
        }
    </script>
</body>
</html>


