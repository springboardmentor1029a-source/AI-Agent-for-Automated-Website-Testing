<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test GUI - E2E Testing Agent</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <style>
        .test-form {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }

        .examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .example-card {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .example-card:hover {
            background: #e3f2fd;
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .example-card h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .example-card p {
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <h1>üß™ Create New Test</h1>
            <p class="subtitle">Define your test scenario in natural language</p>
        </div>

        <!-- Test Form -->
        <div class="card test-form">
            <h2>üìù Test Configuration</h2>
            
            <form id="test-form" onsubmit="runTest(event)">
                <div class="form-group">
                    <label for="test-instruction">Test Instructions:</label>
                    <textarea id="test-instruction" 
                              placeholder="Describe what you want to test in plain English...&#10;&#10;Example:&#10;1. Navigate to the homepage&#10;2. Click the login button&#10;3. Enter username and password&#10;4. Verify dashboard loads"
                              required></textarea>
                </div>

                <div class="form-group">
                    <label for="target-url">Target Website URL:</label>
                    <input type="url" 
                           id="target-url" 
                           placeholder="https://example.com"
                           required>
                </div>

                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button type="submit" class="btn btn-primary">
                        üöÄ Run Test
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="window.location.href='/dashboard'">
                        ‚¨ÖÔ∏è Back to Dashboard
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">
                        üóëÔ∏è Clear Form
                    </button>
                </div>
            </form>
        </div>

        <!-- Example Tests -->
        <div class="card">
            <h2>üí° Example Test Scenarios</h2>
            <p style="color: #666; margin-bottom: 20px;">Click any example to load it into the form</p>
            
            <div class="examples">
                <div class="example-card" onclick="loadExample('google')">
                    <h4>üîç Google Search</h4>
                    <p>Test Google search functionality</p>
                </div>

                <div class="example-card" onclick="loadExample('wikipedia')">
                    <h4>üìö Wikipedia Navigation</h4>
                    <p>Navigate and search Wikipedia</p>
                </div>

                <div class="example-card" onclick="loadExample('form')">
                    <h4>üìã Form Submission</h4>
                    <p>Test form filling and submission</p>
                </div>

                <div class="example-card" onclick="loadExample('custom')">
                    <h4>‚ú® Custom Test</h4>
                    <p>Create your own test scenario</p>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading-indicator" style="display: none;" class="card">
            <div class="loading-container">
                <div class="loading-spinner"></div>
                <h3 style="margin-top: 20px;">Running Test...</h3>
                <p>This may take a few moments. Please wait.</p>
            </div>
        </div>
    </div>

    <script>
        function runTest(event) {
            event.preventDefault();

            const instruction = document.getElementById('test-instruction').value;
            const targetUrl = document.getElementById('target-url').value;

            if (!instruction || !targetUrl) {
                alert('Please fill in all fields');
                return;
            }

            // Show loading
            document.getElementById('loading-indicator').style.display = 'block';
            document.getElementById('test-form').style.opacity = '0.5';

            // Run test
            fetch('/api/test', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    instruction: instruction,
                    target_url: targetUrl
                })
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('test-form').style.opacity = '1';

                if (data.success) {
                    alert('‚úÖ Test completed successfully!');
                    // Redirect to results
                    if (data.test_id) {
                        window.location.href = `/report/${data.test_id}`;
                    } else {
                        window.location.href = '/dashboard';
                    }
                } else {
                    alert('‚ùå Test failed: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(err => {
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('test-form').style.opacity = '1';
                alert('‚ùå Error: ' + err.message);
            });
        }

        function loadExample(type) {
            let instruction = '';
            let url = '';

            switch(type) {
                case 'google':
                    instruction = `1. Navigate to Google homepage
2. Wait for search box to be visible
3. Type "Playwright testing" in the search box
4. Click the search button
5. Wait for results to load
6. Verify search results are displayed`;
                    url = 'https://www.google.com';
                    break;

                case 'wikipedia':
                    instruction = `1. Navigate to Wikipedia homepage
2. Find the search box
3. Type "Artificial Intelligence" in the search
4. Click search or press Enter
5. Wait for article to load
6. Verify article title is displayed`;
                    url = 'https://www.wikipedia.org';
                    break;

                case 'form':
                    instruction = `1. Navigate to the contact form page
2. Fill in the name field with "John Doe"
3. Fill in the email field with "john@example.com"
4. Fill in the message field with "Test message"
5. Click the submit button
6. Verify success message appears`;
                    url = 'https://example.com';
                    break;

                case 'custom':
                    instruction = `1. Navigate to your target website
2. Describe your test steps here
3. Be specific about what to click, type, or verify
4. You can add as many steps as needed`;
                    url = 'https://';
                    break;
            }

            document.getElementById('test-instruction').value = instruction;
            document.getElementById('target-url').value = url;
        }

        function clearForm() {
            document.getElementById('test-instruction').value = '';
            document.getElementById('target-url').value = '';
        }
    </script>
</body>
</html>
