<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Results - {{ test_id }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/report.css') }}">
</head>
<body>
    <div class="report-container">
        <!-- Header -->
        <div class="report-header {% if result.success %}success{% else %}failure{% endif %}">
            <h1>üß™ Test Execution Report</h1>
            <div class="test-id">Test ID: {{ result.test_id }}</div>
            <div class="report-status-badge">
                {% if result.success %}
                    ‚úÖ PASSED
                {% else %}
                    ‚ùå FAILED
                {% endif %}
            </div>
        </div>

        <!-- Summary -->
        <div class="report-summary">
            <div class="summary-item">
                <h3>‚è±Ô∏è Execution Time</h3>
                <div class="value">{{ "%.2f"|format(result.execution_time) }}s</div>
            </div>

            <div class="summary-item">
                <h3>üåê Target URL</h3>
                <div class="value small">{{ result.target_url }}</div>
            </div>

            <div class="summary-item">
                <h3>üìÖ Timestamp</h3>
                <div class="value small">{{ result.timestamp }}</div>
            </div>

            <div class="summary-item">
                <h3>üì∏ Screenshots</h3>
                <div class="value">{{ result.screenshots|length }}</div>
            </div>
        </div>

        <!-- Message -->
        <div class="report-section">
            <h2>üí¨ Message</h2>
            <div class="message-box {% if result.success %}success{% else %}error{% endif %}">
                {{ result.message }}
            </div>
        </div>

        <!-- Screenshots -->
        {% if result.screenshots %}
        <div class="report-section">
            <h2>üì∏ Screenshots</h2>
            <div class="screenshots-grid">
                {% for screenshot in result.screenshots %}
                <div class="screenshot-item">
                    <h3>Screenshot {{ loop.index }}</h3>
                    <img src="{{ url_for('serve_screenshot', filename=screenshot.split('/')[-1]) }}" 
                         alt="Screenshot {{ loop.index }}"
                         onclick="openModal(this.src)">
                    <p>{{ screenshot.split('/')[-1] }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Errors -->
        {% if result.errors %}
        <div class="report-section">
            <div class="errors-section">
                <h2>‚ùå Errors</h2>
                {% for error in result.errors %}
                <div class="error-item">
                    <strong>Error {{ loop.index }}: {{ error.type }}</strong>
                    <p>{{ error.message }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Logs -->
        {% if result.logs %}
        <div class="report-section">
            <h2>üìù Execution Logs</h2>
            <div class="logs-container">
                {% for log in result.logs %}
                <div class="log-entry">{{ log }}</div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Actions -->
        <div class="report-section">
            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="window.location.href='/dashboard'">
                    üè† Back to Dashboard
                </button>
                <button class="btn btn-secondary" onclick="window.location.href='/test-gui'">
                    üîÑ Run Another Test
                </button>
                <button class="btn btn-secondary" onclick="window.print()">
                    üñ®Ô∏è Print Report
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="report-footer">
            <p>Generated by E2E Testing Agent</p>
            <p>Milestone 4 - Advanced Reporting Module</p>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="image-modal" id="imageModal" onclick="closeModal()">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <script>
        function openModal(src) {
            document.getElementById('imageModal').classList.add('active');
            document.getElementById('modalImage').src = src;
        }

        function closeModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
